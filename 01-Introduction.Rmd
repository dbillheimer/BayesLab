# Introduction - A first example.

Suppose we have a simple experiment with two factors (A/B), each with two levels
(aA, bB), conducted in a factorial design with $n=10$ observations per group.
Our general hypothesis is that either factor A or factor B might increase the
response, or that both together might be required to create an increase.

```{r datasim, fig.width=6}
library(ggplot2)
n <- 10
group <- gl(4, 10, labels=c("ab", "Ab", "aB", "AB"))
mu <- kronecker(c(3, 4, 4, 5), rep(1, 10))
set.seed(1959)
y <- rnorm(4 * n, mu, 1)
qplot(group, y, geom=c("boxplot", "point") ) +
    ggtitle("Observations from a two-factor experiment")

```

A typical "laboratory" analysis would consider group comparisons using
$t$-tests.

For ab vs. Ab
```{r ab.v.Ab}
tt1 <- t.test(y[group=="ab"], y[group=='Ab'])
print(tt1)
```
For ab vs. aB
```{r ab.v.aB}
tt2 <- t.test(y[group=="ab"], y[group=='aB'])
print(tt2)
```

and finally for ab vs. AB
```{r ab.v.AB}
tt3 <- t.test(y[group=="ab"], y[group=='AB'])
print(tt3)
```

A simplistic interpretation is that either A ($p = $`tt1$p.value`) or B
($p = $`tt2$p.value`) alone do not produce an increase, but A and B together
'interact' to create an increase in $y$.

Fix this graph
```{r stars}
qplot(group, y, geom=c("boxplot", "point") ) +
    ggtitle("Observations from a two-factor experiment") +
    geom_segment(aes(x=c(1,1,1), xend=c(2,3,4), y=c(6, 6.4, 6.8), yend=c(6, 6.4, 6.8)),
          arrow=arrow(length=unit(0.1, "cm"), angle=90, ends="both") ) +
    geom_text(aes(x=c(1.5, 2.5, 3.5), y=c(6.15, 6.55, 6.95)),
              label=c(paste("p=", round(tt1$p.value, 2)),
                  paste("p=", round(tt2$p.value, 2)),
                  paste("p=", round(tt3$p.value, 3)) ), cex=3)
```


A slightly better analysis considers the groups (and factors) together.

```{r anova}
a.fac <- factor(rep(c(rep(0, 10), rep(1, 10)), 2), labels=c("a", "A"))
b.fac <- factor(c(rep(0, 20), rep(1, 20)), labels=c("b", "B"))
fac.lm <- lm(y ~ a.fac*b.fac)
anova(fac.lm)
summary(fac.lm)
library(gmodels)
model.mat <- rbind("ab"=c(1, 0, 0, 0),
                   "Ab"=c(1, 1, 0, 0),
                   "aB"=c(1, 0, 1, 0),
                   "AB"=c(1, 0, 0 ,1)
estimable(fit.3, rbind("M-F|A"= c(model.mat[1,] - model.mat[4,])))
### stopped here.

fit.contrast(fac.lm, "a.fac", c(-1, 1), conf=.95)
fit.contrast(fac.lm, "b.fac", c(-1, 1), conf=.95)
intervals(fac.lm)
?fit.contrast
fit.contrast(fac.lm, "a.fac",  coef=c(1, -1), showall=T)

```
